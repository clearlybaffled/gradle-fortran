/*
 * This Groovy source file was generated by the Gradle 'init' task.
 */
package io.github.clearlybaffled.gradle.nativeplugin.toolchain.plugins

import static org.hamcrest.CoreMatchers.is
import static org.junit.Assert.*;

import org.gradle.testkit.runner.GradleRunner
import org.gradle.testkit.runner.TaskOutcome

import groovy.swing.factory.CollectionFactory
import groovy.swing.factory.EmptyBorderFactory
import spock.lang.Specification


class GradleFortranPluginFunctionalTest extends Specification {
/*
	@Rule TemporaryFolder testProjectDir = new TemporaryFolder()
	File buildFile
	File srcDir

	def setup() {
		buildFile = testProjectDir.newFile('build.gradle')
		buildFile << """
            plugins {
                id 'io.github.clearlybaffled.fortran'
            }
        """.stripIndent()
		testProjectDir.newFolder("src","main","fortran")
		testProjectDir.newFile("src/main/fortran/hello.f") << """
			program hello
			      print *, "Hello, World!"
			end program hello
		""".stripIndent()
	
	}
	
	
    def "builds program"() {
        given:
		buildFile << """
			model {
				components {
					test(NativeExecutableSpec)
				}
			}
        """

        when:
	    def result = GradleRunner.create()
        	.forwardOutput()
	        .withPluginClasspath()
	        .withArguments("--stacktrace", "--info", "build")
			.withDebug(true)
	        .withProjectDir(testProjectDir.root)
			.build()
		
		
        then:
        //result.task(":assemble").outcome == SUCCESS
		//result.task(":build").outcome == SUCCESS
		
	
		
		assertTrue(new File("${testProjectDir.root.absolutePath}/build").exists())
    }
	*/
	def "builds from real filesystem"() {
		given:
		def runner = GradleRunner.create()
			.forwardOutput()
			.withPluginClasspath()
			.withArguments("--stacktrace","--debug","clean","build")
			.withDebug(true)
			.withProjectDir(new File("src/test/resources/helloworld"))
		when:
		def result
		try {
			result = runner.build()
		} catch (ex) {
			println ex.message
		}
		then:
		
		assertTrue(result.tasks(TaskOutcome.FAILED).isEmpty())
	}
	
}
